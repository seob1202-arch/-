<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Global Market</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .modal { transition: opacity 0.25s ease; }
    body { background-color: #f3f4f6; font-family: 'Noto Sans KR', sans-serif; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="text-gray-800">

  <script>
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycbw-6DyS3CmRxiw0Fbr-0s62myCwj8TsqExLoktQbQOvUEarFHXzpGBmoQQRHs7Phd5MMA/exec"; 
    // 예: "https://script.google.com/macros/s/AKfycbx.../exec"
  </script>

  <nav class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2 cursor-pointer" onclick="showPage('list')">
        <i class="fa-solid fa-earth-americas text-blue-600 text-2xl"></i>
        <span class="text-xl font-bold text-blue-600">글로벌 한인장터</span>
      </div>
      <button onclick="showPage('write')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition hidden md:block">
        <i class="fa-solid fa-pen mr-1"></i> 상품 등록
      </button>
    </div>
  </nav>

  <main class="max-w-6xl mx-auto px-4 py-6 min-h-screen">
    
    <div id="list-page">
      <div class="bg-white p-4 rounded-xl shadow-sm mb-6 grid grid-cols-2 md:grid-cols-5 gap-3">
        <select id="filter-country" class="border p-2 rounded" onchange="filterItems()">
          <option value="">전체 국가</option>
        </select>
        <input type="text" id="filter-city" placeholder="도시 (예: 런던)" class="border p-2 rounded" onkeyup="filterItems()">
        <select id="filter-category" class="border p-2 rounded" onchange="filterItems()">
          <option value="">모든 카테고리</option>
          <option value="디지털/가전">디지털/가전</option>
          <option value="가구/인테리어">가구/인테리어</option>
          <option value="생활/가공식품">생활/가공식품</option>
          <option value="유아동/출산">유아동/출산</option>
          <option value="의류/잡화">의류/잡화</option>
          <option value="기타">기타</option>
        </select>
        <input type="text" id="filter-keyword" placeholder="검색어" class="border p-2 rounded col-span-2 md:col-span-2" onkeyup="filterItems()">
      </div>

      <div id="loading" class="flex justify-center py-10">
        <div class="loader"></div>
      </div>

      <div id="item-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      
      <div id="no-data" class="hidden text-center py-10 text-gray-500">
        등록된 물품이 없습니다.
      </div>
    </div>

    <div id="write-page" class="hidden max-w-2xl mx-auto bg-white p-6 rounded-xl shadow-md">
      <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">물품 등록</h2>
      <form id="upload-form" onsubmit="handleUpload(event)">
        
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium mb-1">국가</label>
            <select name="country" id="input-country" class="w-full border p-2 rounded bg-gray-50" required onchange="handleCountryChange(this.value)">
              <option value="">국가 선택</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">도시</label>
            <input type="text" name="city" class="w-full border p-2 rounded" placeholder="예: 밴쿠버" required>
          </div>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">카테고리</label>
          <select name="category" class="w-full border p-2 rounded" required>
            <option value="디지털/가전">디지털/가전</option>
            <option value="가구/인테리어">가구/인테리어</option>
            <option value="생활/가공식품">생활/가공식품</option>
            <option value="유아동/출산">유아동/출산</option>
            <option value="의류/잡화">의류/잡화</option>
            <option value="기타">기타</option>
          </select>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">상품명</label>
          <input type="text" name="title" class="w-full border p-2 rounded" required>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">상세 설명</label>
          <textarea name="description" class="w-full border p-2 rounded h-32" required></textarea>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium mb-1">사용 기간</label>
            <select name="usage" class="w-full border p-2 rounded">
              <option value="미개봉">미개봉</option>
              <option value="1개월 미만">1개월 미만</option>
              <option value="1~6개월">1~6개월</option>
              <option value="6개월~1년">6개월~1년</option>
              <option value="1년 이상">1년 이상</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">거래 방법</label>
            <div class="flex space-x-4 mt-2">
              <label><input type="radio" name="delivery" value="직거래" checked> 직거래</label>
              <label><input type="radio" name="delivery" value="택배"> 택배</label>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-4">
          <div class="flex gap-2">
            <div class="w-1/3">
              <label class="block text-sm font-medium mb-1">통화</label>
              <input type="text" name="currency" id="currency-input" class="w-full border p-2 rounded bg-gray-100" readonly required>
            </div>
            <div class="w-2/3">
              <label class="block text-sm font-medium mb-1">가격</label>
              <input type="number" name="price" class="w-full border p-2 rounded" required>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">판매 종료일</label>
            <input type="date" name="endDate" class="w-full border p-2 rounded" required>
          </div>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium mb-1">사진 (최대 3장)</label>
          <input type="file" id="img-input" accept="image/*" multiple onchange="handleImagePreview(this)" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 mb-2">
          <div id="preview-container" class="flex gap-2 overflow-x-auto"></div>
          <p class="text-xs text-red-500 mt-1">* 용량 제한으로 이미지는 자동 리사이징됩니다.</p>
        </div>

        <hr class="my-6 border-gray-200">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium mb-1">전화번호</label>
            <input type="text" name="phone" id="phone-input" class="w-full border p-2 rounded" placeholder="코드 자동 입력">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">카카오톡 ID</label>
            <input type="text" name="kakaoId" class="w-full border p-2 rounded">
          </div>
        </div>
        <div class="mb-6">
            <label class="block text-sm font-medium mb-1">오픈채팅 URL</label>
            <input type="text" name="openChat" class="w-full border p-2 rounded">
        </div>

        <div class="mb-6">
            <label class="block text-sm font-medium mb-1">관리 비밀번호</label>
            <input type="password" name="password" class="w-full border p-2 rounded bg-yellow-50" placeholder="삭제/수정 시 필요" required>
        </div>

        <button type="submit" id="submit-btn" class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition">등록하기</button>
        <button type="button" onclick="showPage('list')" class="w-full mt-2 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition">취소</button>
      </form>
    </div>

  </main>

  <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4 modal">
    <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto relative no-scrollbar">
      <button onclick="closeModal('detail-modal')" class="absolute top-4 right-4 text-white bg-black bg-opacity-30 hover:bg-opacity-50 rounded-full w-8 h-8 z-10"><i class="fa-solid fa-xmark"></i></button>
      <div id="modal-images" class="w-full h-72 bg-gray-900 flex overflow-x-auto snap-x snap-mandatory no-scrollbar"></div>
      <div class="p-6">
        <div class="flex justify-between items-start mb-2">
            <div><span id="modal-country-city" class="text-xs font-semibold bg-blue-100 text-blue-800 px-2 py-1 rounded"></span><span id="modal-category" class="ml-1 text-xs font-semibold bg-gray-100 text-gray-800 px-2 py-1 rounded"></span></div>
            <span id="modal-time-left" class="text-xs text-red-500 font-bold border border-red-200 px-2 py-1 rounded"></span>
        </div>
        <h3 id="modal-title" class="text-2xl font-bold mb-1 break-words"></h3>
        <p id="modal-price" class="text-xl text-blue-600 font-bold mb-4"></p>
        <div class="bg-gray-50 p-3 rounded mb-4 text-sm text-gray-700 space-y-1">
            <p><i class="fa-solid fa-box w-5 text-gray-400"></i> <span id="modal-usage"></span></p>
            <p><i class="fa-solid fa-truck w-5 text-gray-400"></i> <span id="modal-delivery"></span></p>
            <p><i class="fa-regular fa-clock w-5 text-gray-400"></i> <span id="modal-end-date"></span></p>
        </div>
        <div class="bg-white border rounded p-3 mb-6 min-h-[100px]"><p id="modal-desc" class="text-gray-600 whitespace-pre-wrap text-sm"></p></div>
        <div class="flex flex-col gap-2 mb-4">
            <button id="btn-phone" class="hidden w-full bg-green-500 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2"><i class="fa-solid fa-phone"></i> 전화번호 보기</button>
            <button id="btn-kakao-copy" class="hidden w-full bg-yellow-400 text-black py-3 rounded-lg font-bold flex items-center justify-center gap-2"><i class="fa-solid fa-comment"></i> 카톡 ID 복사</button>
            <button id="btn-open-chat" class="hidden w-full bg-gray-100 text-gray-800 py-3 rounded-lg font-bold flex items-center justify-center gap-2"><i class="fa-solid fa-arrow-up-right-from-square"></i> 오픈채팅</button>
        </div>
        <div class="border-t pt-4 flex justify-end"><button onclick="openDeleteModal()" class="text-gray-400 text-sm underline hover:text-red-500">게시글 삭제</button></div>
      </div>
    </div>
  </div>

  <div id="password-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg p-6 max-w-sm w-full shadow-lg">
        <h3 class="text-lg font-bold mb-4">비밀번호 확인</h3>
        <input type="password" id="delete-password" class="w-full border p-2 rounded mb-4" placeholder="비밀번호 입력">
        <div class="flex justify-end gap-2">
            <button onclick="closeModal('password-modal')" class="px-4 py-2 bg-gray-200 rounded">취소</button>
            <button onclick="submitDelete()" class="px-4 py-2 bg-red-500 text-white rounded">삭제</button>
        </div>
    </div>
  </div>
  
  <div id="custom-alert-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-[60] flex items-center justify-center p-4">
    <div class="bg-white rounded-xl p-6 max-w-sm w-full shadow-2xl transform transition-all scale-100">
        <div class="text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4">
                <i class="fa-solid fa-check text-blue-600 text-xl"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">알림</h3>
            <p id="custom-alert-message" class="text-sm text-gray-500 mb-6">내용</p>
            <button onclick="confirmCustomAlert()" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg font-bold hover:bg-blue-700 focus:outline-none transition">
                확인
            </button>
        </div>
    </div>
  </div>

  <button onclick="showPage('write')" class="md:hidden fixed bottom-6 right-6 bg-blue-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-2xl hover:bg-blue-700 z-40 transition transform active:scale-95"><i class="fa-solid fa-plus"></i></button>

  <script>
    // --- 설정 및 데이터 ---
    const COUNTRY_DATA = {
        '한국': { code: '+82', currency: '₩' }, '미국': { code: '+1', currency: '$' }, '캐나다': { code: '+1', currency: 'C$' }, '일본': { code: '+81', currency: '¥' }, '중국': { code: '+86', currency: '¥' }, '호주': { code: '+61', currency: 'A$' }, '뉴질랜드': { code: '+64', currency: 'NZ$' }, '영국': { code: '+44', currency: '£' }, '독일': { code: '+49', currency: '€' }, '프랑스': { code: '+33', currency: '€' }, '베트남': { code: '+84', currency: '₫' }, '필리핀': { code: '+63', currency: '₱' }, '태국': { code: '+66', currency: '฿' }, '싱가포르': { code: '+65', currency: 'S$' }, '말레이시아': { code: '+60', currency: 'RM' }, '인도네시아': { code: '+62', currency: 'Rp' }, '브라질': { code: '+55', currency: 'R$' }, '러시아': { code: '+7', currency: '₽' }, '우즈베키스탄': { code: '+998', currency: 'som' }, '카자흐스탄': { code: '+7', currency: '₸' }
    };

    let allItems = [];
    let currentDetailId = null;
    let selectedImages = [];
    
    // [NEW] 커스텀 알림 콜백 변수
    let customAlertCallback = null;

    // [NEW] 커스텀 알림 함수
    function showCustomAlert(message, callback = null) {
        document.getElementById('custom-alert-message').textContent = message;
        document.getElementById('custom-alert-modal').classList.remove('hidden');
        customAlertCallback = callback;
    }

    // [NEW] 커스텀 알림 확인 버튼 처리
    function confirmCustomAlert() {
        document.getElementById('custom-alert-modal').classList.add('hidden');
        if (customAlertCallback) {
            customAlertCallback();
            customAlertCallback = null; // 초기화
        }
    }

    // --- 통신 유틸리티 (Fetch API) ---
    async function apiFetch(method, body = null) {
      if (GAS_API_URL.includes("여기에")) {
        showCustomAlert("Code.gs 배포 후 URL을 index.html의 GAS_API_URL 변수에 넣어야 합니다.");
        return null;
      }

      const options = {
        method: method,
      };

      if (method === 'POST' && body) {
        options.body = JSON.stringify(body);
        options.headers = { "Content-Type": "text/plain;charset=utf-8" };
      }

      try {
        const response = await fetch(GAS_API_URL, options);
        return await response.json();
      } catch (error) {
        console.error("API Error:", error);
        showCustomAlert("서버 통신 중 오류가 발생했습니다.");
        return null;
      }
    }

    // --- 초기화 ---
    window.onload = function() {
      initCountryOptions();
      fetchItems();
    };

    function initCountryOptions() {
        const selectFilter = document.getElementById('filter-country');
        const selectInput = document.getElementById('input-country');
        Object.keys(COUNTRY_DATA).sort().forEach(country => {
            selectFilter.appendChild(new Option(country, country));
            selectInput.appendChild(new Option(country, country));
        });
    }

    function handleCountryChange(val) {
        const data = COUNTRY_DATA[val];
        if (data) {
            document.getElementById('currency-input').value = data.currency;
            document.getElementById('phone-input').value = data.code + ' ';
        } else {
            document.getElementById('currency-input').value = '';
            document.getElementById('phone-input').value = '';
        }
    }

    function showPage(pageId) {
      document.getElementById('list-page').classList.toggle('hidden', pageId !== 'list');
      document.getElementById('write-page').classList.toggle('hidden', pageId !== 'write');
      if (pageId === 'list') fetchItems();
      window.scrollTo(0, 0);
    }

    // --- 데이터 조회 (READ) ---
    async function fetchItems() {
      document.getElementById('loading').classList.remove('hidden');
      document.getElementById('item-grid').innerHTML = '';
      document.getElementById('no-data').classList.add('hidden');

      const data = await apiFetch('GET');
      
      document.getElementById('loading').classList.add('hidden');
      if (data) {
        allItems = data;
        renderItems(allItems);
      }
    }

    function renderItems(items) {
      const grid = document.getElementById('item-grid');
      grid.innerHTML = '';
      if (items.length === 0) {
        document.getElementById('no-data').classList.remove('hidden');
        return;
      } else {
        document.getElementById('no-data').classList.add('hidden');
      }

      items.forEach(item => {
        let images = [];
        try { images = JSON.parse(item.images); } catch(e) {}
        const thumb = images.length > 0 ? images[0] : 'https://via.placeholder.com/400x300?text=No+Image';
        
        const endD = new Date(item.endDate);
        const diffDays = Math.ceil((endD - new Date()) / (1000 * 60 * 60 * 24));
        const dDay = diffDays < 0 ? "마감" : (diffDays === 0 ? "오늘마감" : `D-${diffDays}`);

        const div = document.createElement('div');
        div.className = "bg-white rounded-xl shadow-sm hover:shadow-md transition cursor-pointer overflow-hidden flex flex-col";
        div.onclick = () => openDetail(item);
        div.innerHTML = `
          <div class="h-48 bg-gray-200 overflow-hidden relative group">
            <img src="${thumb}" class="w-full h-full object-cover transform group-hover:scale-105 transition duration-500">
            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                <span class="text-white text-xs font-bold px-1">${item.country}</span>
            </div>
          </div>
          <div class="p-4 flex-1 flex flex-col">
            <div class="flex justify-between items-start mb-1">
               <h3 class="font-bold text-lg truncate w-3/4 text-gray-800">${item.title}</h3>
               <span class="text-xs font-bold text-red-500 bg-red-50 px-2 py-0.5 rounded">${dDay}</span>
            </div>
            <p class="text-sm text-gray-500 mb-3 truncate">${item.city} · ${item.category}</p>
            <div class="mt-auto"><span class="text-lg font-bold text-blue-600">${item.currency} ${Number(item.price).toLocaleString()}</span></div>
          </div>
        `;
        grid.appendChild(div);
      });
    }

    function filterItems() {
      const country = document.getElementById('filter-country').value;
      const city = document.getElementById('filter-city').value.toLowerCase();
      const category = document.getElementById('filter-category').value;
      const keyword = document.getElementById('filter-keyword').value.toLowerCase();

      const filtered = allItems.filter(item => {
        return (country === "" || item.country === country) &&
               (city === "" || item.city.toLowerCase().includes(city)) &&
               (category === "" || item.category === category) &&
               (keyword === "" || item.title.toLowerCase().includes(keyword) || item.description.toLowerCase().includes(keyword));
      });
      renderItems(filtered);
    }

    // --- 상세 모달 ---
    function openDetail(item) {
      currentDetailId = item.id;
      const modal = document.getElementById('detail-modal');
      
      document.getElementById('modal-title').textContent = item.title;
      document.getElementById('modal-country-city').textContent = `${item.country} | ${item.city}`;
      document.getElementById('modal-category').textContent = item.category;
      document.getElementById('modal-price').textContent = `${item.currency} ${Number(item.price).toLocaleString()}`;
      document.getElementById('modal-usage').textContent = item.usage;
      document.getElementById('modal-delivery').textContent = item.delivery;
      document.getElementById('modal-end-date').textContent = item.endDate.split('T')[0];
      document.getElementById('modal-desc').textContent = item.description;

      const imgContainer = document.getElementById('modal-images');
      imgContainer.innerHTML = '';
      let images = [];
      try { images = JSON.parse(item.images); } catch(e) {}
      if(images.length === 0) imgContainer.innerHTML = '<div class="w-full h-full flex items-center justify-center text-gray-400 bg-gray-100">이미지 없음</div>';
      else images.forEach(src => {
        const img = document.createElement('img');
        img.src = src;
        img.className = "snap-center w-full h-full object-contain bg-black";
        imgContainer.appendChild(img);
      });

      // 버튼 제어
      const setupBtn = (id, val, clickHandler) => {
        const el = document.getElementById(id);
        if(val) { el.classList.remove('hidden'); el.onclick = clickHandler; }
        else el.classList.add('hidden');
      };

      setupBtn('btn-phone', item.phone, () => {
         if(/Android|iPhone/i.test(navigator.userAgent)) window.location.href = `tel:${item.phone}`;
         else navigator.clipboard.writeText(item.phone).then(() => showCustomAlert('전화번호가 복사되었습니다.'));
      });
      setupBtn('btn-kakao-copy', item.kakaoId, () => navigator.clipboard.writeText(item.kakaoId).then(() => showCustomAlert('카카오톡 ID가 복사되었습니다.')));
      setupBtn('btn-open-chat', (item.openChat && item.openChat.startsWith('http')), () => window.open(item.openChat, '_blank'));

      modal.classList.remove('hidden');
    }

    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

    // --- 데이터 삭제 (DELETE) ---
    function openDeleteModal() {
        document.getElementById('password-modal').classList.remove('hidden');
        document.getElementById('delete-password').value = '';
    }

    async function submitDelete() {
        const pw = document.getElementById('delete-password').value;
        if(!pw) return showCustomAlert('비밀번호를 입력하세요.');
        
        const btn = document.querySelector('#password-modal button.bg-red-500');
        const originText = btn.textContent;
        btn.textContent = '처리중...';

        const res = await apiFetch('POST', { action: 'delete', id: currentDetailId, password: pw });
        
        btn.textContent = originText;
        if(res && res.success) {
            // [MODIFIED] 커스텀 알림 적용 (삭제 성공 시)
            closeModal('password-modal');
            closeModal('detail-modal');
            showCustomAlert('삭제되었습니다.', () => {
                fetchItems();
            });
        } else {
            showCustomAlert(res ? res.message : '삭제 실패');
        }
    }

    // --- 데이터 등록 (CREATE) ---
    function handleImagePreview(input) {
      const container = document.getElementById('preview-container');
      container.innerHTML = '';
      selectedImages = [];
      Array.from(input.files).slice(0, 3).forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const maxW = 600; 
            const scale = maxW / img.width;
            canvas.width = maxW;
            canvas.height = img.height * scale;
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            const dataUrl = canvas.toDataURL('image/jpeg', 0.6);
            selectedImages.push(dataUrl);
            const thumb = document.createElement('img');
            thumb.src = dataUrl;
            thumb.className = "h-20 w-20 object-cover rounded shadow border shrink-0";
            container.appendChild(thumb);
          }
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    }

    async function handleUpload(e) {
      e.preventDefault();
      const btn = document.getElementById('submit-btn');
      btn.disabled = true;
      btn.textContent = "저장 중...";

      const form = document.getElementById('upload-form');
      const formData = {
        action: 'create',
        country: form.country.value,
        city: form.city.value,
        category: form.category.value,
        title: form.title.value,
        description: form.description.value,
        usage: form.usage.value,
        delivery: form.delivery.value,
        currency: form.currency.value,
        price: form.price.value,
        endDate: form.endDate.value,
        phone: form.phone.value,
        kakaoId: form.kakaoId.value,
        openChat: form.openChat.value,
        password: form.password.value,
        images: selectedImages
      };

      const res = await apiFetch('POST', formData);

      btn.disabled = false;
      btn.textContent = "등록하기";
      if(res && res.success) {
        // [MODIFIED] alert() 대신 커스텀 모달 사용
        showCustomAlert("등록되었습니다!", () => {
            form.reset();
            document.getElementById('preview-container').innerHTML = '';
            selectedImages = [];
            showPage('list');
        });
      } else {
        showCustomAlert("등록 실패: " + (res ? res.error : '알 수 없는 오류'));
      }
    }
  </script>
</body>
</html>
